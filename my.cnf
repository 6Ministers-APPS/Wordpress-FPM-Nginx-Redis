[client]
# Гарантируем, что клиент (WP) и сервер говорят на одной кодировке
default-character-set = utf8mb4

[mysqld]
# --- БАЗОВЫЕ НАСТРОЙКИ ---
skip-name-resolve          # Не тратить время на DNS резолв
default_storage_engine = InnoDB
max_connections = 150      # Оптимально для одного сайта

# --- КОДИРОВКА (ВАЖНО ДЛЯ WORDPRESS) ---
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
# Для MariaDB 10.6+ и 11 это дефолт, но лучше указать явно,
# чтобы избежать проблем при переносе дампов.

# --- ЛИМИТЫ ДАННЫХ ---
# Критично для импорта демо-данных, Elementor и плагинов миграции
max_allowed_packet = 64M

# --- INNODB ОПТИМИЗАЦИЯ (ПАМЯТЬ) ---
# Буфер пула: 50-70% от RAM контейнера.
# Для сервера 4GB RAM -> 1G или 1.5G — отлично.
innodb_buffer_pool_size = 1G

# Логи транзакций. 256M достаточно для высокой нагрузки.
innodb_log_file_size = 256M

# --- INNODB ОПТИМИЗАЦИЯ (СКОРОСТЬ ЗАПИСИ) ---
# 2 = писать в кэш ОС и сбрасывать на диск раз в секунду.
# Это дает огромный прирост скорости записи по сравнению с 1.
# Риск: при крахе ОС (не просто MySQL, а именно сервера) теряется 1 сек данных.
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# --- SSD ТЮНИНГ ---
# Если у вас VPS на SSD/NVMe
innodb_io_capacity = 1000
innodb_io_capacity_max = 2000

# Отключение бинарных логов (если нет репликации).
# Экономит место на диске и снижает нагрузку на I/O.
skip-log-bin

# --- ВРЕМЕННЫЕ ТАБЛИЦЫ ---
# Если временная таблица не влезает в эти лимиты, она пишется на диск.
# 64M — хорошее значение.
tmp_table_size = 64M
max_heap_table_size = 64M

# --- КЭШ ЗАПРОСОВ (ОТКЛЮЧИТЬ) ---
# В MySQL 8.0 удален, в MariaDB бесполезен при наличии Redis.
query_cache_type = 0
query_cache_size = 0

# --- ДВОЙНАЯ ЗАПИСЬ (БЕЗОПАСНОСТЬ) ---
# Оставьте закомментированным или = 1.
# Отключение (=0) ускоряет запись, но при сбое питания файл БД может быть поврежден безвозвратно.
# innodb_doublewrite = 1