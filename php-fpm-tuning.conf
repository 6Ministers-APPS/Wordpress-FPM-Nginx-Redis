[www]
; ---------------------------------------
; РЕЖИМ РАБОТЫ (PROCESS MANAGER)
; ---------------------------------------
; Используем static для максимальной производительности под нагрузкой.
; Процессы создаются сразу и не тратятся ресурсы CPU на их удаление/создание.
pm = static

; ---------------------------------------
; КОЛИЧЕСТВО ПРОЦЕССОВ
; ---------------------------------------
; Рассчет для 4GB RAM: 
; (4096MB Total - 1024MB DB - 256MB NginxCache - 300MB System) / ~60MB на процесс = ~40.
; Берем 35 с запасом для стабильности.
pm.max_children = 35

; ---------------------------------------
; УПРАВЛЕНИЕ ПАМЯТЬЮ И ТАЙМАУТЫ
; ---------------------------------------
; Перезапускать процесс каждые 1500 запросов (защита от утечек памяти)
pm.max_requests = 1500

; Если запрос выполняется дольше 45 сек — убиваем процесс, 
; чтобы он не вешал очередь остальных пользователей.
request_terminate_timeout = 45s

; (Опционально) Логирование медленных скриптов (>10 сек)
slowlog = /var/log/php-fpm-slow.log
request_slowlog_timeout = 10s